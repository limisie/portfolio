---
import { Image } from "astro:assets";

import BurgerMenu from "@components/atoms/BurgerMenu.astro";
import ThemeSwitcher from "@components/atoms/ThemeSwitcher.astro";
import LinkUnderline from "@components/atoms/LinkUnderline.astro";
---

<header class="flex">
    <a href="/">
        <Image src="/favicon.svg" alt="limi logo" width={48} height={48} />
    </a>

    <nav class="hidden">
        <ul class="flex">
            <li><LinkUnderline href="/">Home</LinkUnderline></li>
            <li><LinkUnderline href="/portfolio">Portfolio</LinkUnderline></li>
            <li><LinkUnderline href="/blog">Blog</LinkUnderline></li>
            <li><LinkUnderline href="/contact">Contact</LinkUnderline></li>
            <li>
                <ThemeSwitcher {...Astro.props} />
            </li>
        </ul>
    </nav>

    <BurgerMenu />
</header>

<style>
    header {
        position: fixed;
        z-index: 999;
        top: 0;
        left: 0;
        right: 0;
        height: calc(var(--nav-height) + 2 * var(--spacer));

        padding: var(--spacer);

        align-items: flex-start;

        backdrop-filter: blur(0);
        -webkit-backdrop-filter: blur(0);
        transition:
            -webkit-backdrop-filter 0.5s ease-out,
            backdrop-filter 0.5s ease-out,
            height 0.01s ease-out 0.5s;

        nav {
            width: 0;
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0;
            min-height: var(--nav-height);

            gap: calc(2 * var(--spacer));
        }

        &.unfolded {
            height: 100vh;

            backdrop-filter: blur(var(--spacer));
            -webkit-backdrop-filter: blur(var(--spacer));
            transition:
                height 0.01s ease-out,
                backdrop-filter 0.5s ease-out,
                -webkit-backdrop-filter 0.5s ease-out;

            ul {
                padding-top: 5rem;

                flex-direction: column;
            }
        }
    }

    @media (min-width: 40rem) {
        header {
            height: calc(var(--nav-height) + 2 * var(--spacer));
            padding: var(--spacer);

            nav {
                width: 100%;
                max-width: calc(
                    var(--container-width) - 2 * var(--container-padding)
                );
                opacity: 1;

                &.animated {
                    transition: all 0.2s ease-in;
                }
            }

            ul {
                justify-content: flex-end;
            }
        }
    }
</style>

<script>
    const header = document.querySelector("header");
    const nav = document.querySelector("nav");
    const hamburgerButton = document.querySelector("#menuButton");

    function toggleNav(animate = true) {
        if (
            window.scrollY < 50 &&
            window.matchMedia("(min-width: 40rem)").matches
        ) {
            if (animate) {
                nav.classList.add("animated");
            }
            nav.classList.remove("hidden");
            hamburgerButton.classList.add("hidden");
            setTimeout(() => {
                nav.classList.remove("animated");
            }, 200);
        } else if (
            window.scrollY >= 50 ||
            !window.matchMedia("(min-width: 40rem)").matches
        ) {
            if (!header.classList.contains("unfolded")) {
                nav.classList.add("hidden");
                hamburgerButton.classList.remove("hidden");
            }
        }
    }

    toggleNav(false);
    window.addEventListener("scroll", () => toggleNav());
    window.addEventListener("resize", () => toggleNav());
</script>
